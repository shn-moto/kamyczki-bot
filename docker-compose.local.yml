services:
  bot:
    build:
      context: .
      dockerfile: Dockerfile.local
    container_name: kamyczki-bot-local
    env_file:
      - .env.local
    environment:
      - USE_LOCAL_ML=true
      - USE_WEBHOOK=true
      - PORT=8080
    restart: unless-stopped

  # Убедитесь, что cloudflared начинается с того же количества пробелов, что и bot выше
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: kamyczki-tunnel
    # Фиксируем порт 2000 для метрик, чтобы скрипт ожидания его нашел
    command: tunnel --no-autoupdate --url http://bot:8080 --metrics 0.0.0.0:2000
    restart: unless-stopped